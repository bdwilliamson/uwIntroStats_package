\documentclass[landscape]{article}
\usepackage{amsmath,amsthm,amsfonts,amssymb,amscd}
\usepackage{fullpage}
\usepackage{lastpage}
\usepackage{enumerate}
\usepackage{fancyhdr}
\usepackage[percent]{overpic}
\usepackage{mathrsfs}
\usepackage{wrapfig}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{url}
\usepackage{amssymb}
\usepackage{amscd}
\usepackage{lscape}
\usepackage{graphicx}
\usepackage[usenames,dvipsnames]{color}
\usepackage{listings}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage[left=2cm,right=2cm,top=2.5cm,bottom=2.5cm, headsep = 0.9cm]{geometry}
\usepackage{verbdef}
\setlength{\parindent}{0.0in}
\setlength{\parskip}{0.0in}
\usepackage{setspace}
\definecolor{gray}{RGB}{90,90,90}
\usepackage[colorlinks=true, linktoc=all, linkcolor=blue]{hyperref}
\usepackage{fancyvrb}
\usepackage{Sweave}
\usepackage{indentfirst}
\DefineVerbatimEnvironment{Sinput}{Verbatim} {xleftmargin=2em}
\DefineVerbatimEnvironment{Soutput}{Verbatim}{xleftmargin=2em}
\DefineVerbatimEnvironment{Scode}{Verbatim}{xleftmargin=2em}
\fvset{listparameters={\setlength{\topsep}{0pt}}}
\renewenvironment{Schunk}{\vspace{\topsep}}{\vspace{\topsep}}
\pagestyle{plain}
\setlength\parindent{1cm}

\begin{document}
\input{test_cases-concordance}
\centerline{\large{\textbf{Using \texttt{uwIntroStats}}}}
\centerline{\textbf{Authors: Brian D. Williamson and Scott S. Emerson, M.D., Ph.D.}}
\centerline{\textbf{University of Washington Department of Biostatistics}}
\tableofcontents
\newpage
\section{Introduction}

\section{Preparing \texttt{uwIntroStats}}


\indent Before we can dive in and run any analyses, we first need to install the package. This is done via
\begin{Schunk}
\begin{Sinput}
> install.packages("uwIntroStats")
\end{Sinput}
\end{Schunk}


Regardless of the graphical user interface (GUI) that you are using, R will prompt you to select a CRAN mirror. It is essentially asking you where you want to download the package files from. Select the mirror closest to you - for us at the University of Washington it is \texttt{WA(1)} or the Fred Hutchinson Cancer Research Center (FHCRC) - and the package will download and say that it has installed. Now each time we open a new R session (whether that is at the command line, a new RGui window, or a new RStudio window) we need to load the package for use. 

The \texttt{uwIntroStats} package relies on five other packages. These other packages provide key functions that the \texttt{uwIntroStats} package uses or adds functionality to. We must install these packages like we did above if we have not installed them previously, and then load \texttt{uwIntroStats}. While these packages do not need to be loaded every time (in fact, some are only used for specific functions) it is good practice to load them for the R session where you need to use \texttt{uwIntroStats}.
\begin{Schunk}
\begin{Sinput}
> library(Exact)
> library(geepack)
> library(plyr)
> library(sandwich)
> library(survival)
> library(uwIntroStats)
\end{Sinput}
\end{Schunk}

Last, we load the data, \texttt{mri} that we will be using throughout this document. Information about the dataset can be found at \url{http://www.emersonstatistics.com/datasets/mri.pdf}. Since the data is part of the package, we can load it via
\begin{Schunk}
\begin{Sinput}
> data(mri)
\end{Sinput}
\end{Schunk}

The \texttt{uwIntroStats} package should be used for descriptive statistics, basic plotting (like scatterplots and boxplots), and regression analyses. The following sections will go through examples of these tasks, in addition to pointing out how our package differs from base R and other existing packages. We will assume familiarity with basic data manipulation and statistical tasks (for a refresher, see \url{http://www.emersonstatistics.com/GeneralMaterials/R/IntroToR.pdf}).

\section{Descriptive Statistics}
Descriptive statistics are an important part of any analysis. Often, they are just as important for the statistician or data analysist as they are for the scientific collaborators on a project. For example, descriptive statistics can help identify errors in the data, like observations that are particularly unusual (usually far out of the expected or observed range). They can also help to identify patterns of missing data, examine the study population, and identify aspects of the data that might lead to statistical issues. Descriptive statistics can also unearth relationships that had not previously been considered for analysis, thereby generating new studies. More information on this, and an outline of an approach to analysing a dataset, was written by Scott Emerson and can be found at \url{http://www.emersonstatistics.com/GeneralMaterials/analysis.pdf}. 

\subsection{The basics: \texttt{descrip()}}
The \texttt{uwIntroStats} package was designed with descriptive statistics in mind. The basic function for descriptive statistics is \texttt{descrip()}. This function takes in an arbitrary number of variables, and by default calculates the number of observations, the number of missing values, the mean, standard deviation, mininum value, maximum value, and the 25th, 50th, and 75th percentiles of each variable. For instance, if we wanted a quick glance at the \texttt{mri} data, we could type
\begin{Schunk}
\begin{Sinput}
> descrip(mri)
\end{Sinput}
\begin{Soutput}
            N     Msng  Mean      Std Dev    Min       25%       Mdn       75%       Max      
    ptid:     735     0   368.0     212.3     1.000     184.5     368.0     551.5      735.0  
 mridate:     735     0   76423     31896     10192     66642     80992     91392    1.232e+05
     age:     735     0   74.57     5.451     65.00     71.00     74.00     78.00      99.00  
    male:     735     0   0.4980    0.5003    0.0000    0.0000    0.0000    1.000      1.000  
    race:     735     0   1.318     0.6659    1.000     1.000     1.000     1.000      4.000  
  weight:     735     0   159.9     30.74     74.00     138.5     158.0     179.0      264.0  
  height:     735     0   165.8     9.710     139.0     158.0     165.9     173.2      190.5  
 packyrs:     735     1   19.60     27.11     0.0000    0.0000    6.500     33.75      240.0  
 yrsquit:     735     0   9.661     14.10     0.0000    0.0000    0.0000    18.50      56.00  
   alcoh:     735     0   2.109     4.852     0.0000    0.0000   0.01920    1.144      35.00  
 physact:     735     0   1.922     2.052     0.0000    0.5538    1.312     2.513      13.81  
     chf:     735     0  0.05578    0.2297    0.0000    0.0000    0.0000    0.0000     1.000  
     chd:     735     0   0.3347    0.6862    0.0000    0.0000    0.0000    0.0000     2.000  
  stroke:     735     0   0.2367    0.6207    0.0000    0.0000    0.0000    0.0000     2.000  
diabetes:     735     0   0.1075    0.3099    0.0000    0.0000    0.0000    0.0000     1.000  
 genhlth:     735     0   2.588     0.9382    1.000     2.000     3.000     3.000      5.000  
     ldl:     735    10   125.8     33.60     11.00     102.0     125.0     147.0      247.0  
     alb:     735     2   3.994     0.2690    3.200     3.800     4.000     4.200      5.000  
     crt:     735     2   1.064     0.3030    0.5000    0.9000    1.000     1.200      4.000  
     plt:     735     7   246.0     65.80     92.00     201.8     239.0     285.0      539.0  
     sbp:     735     0   131.1     19.66     78.00     118.0     130.0     142.0      210.0  
     aai:     735     9   1.103     0.1828    0.3171    1.027     1.112     1.207      1.728  
     fev:     735    10   2.207     0.6875    0.4083    1.745     2.158     2.649      4.471  
    dsst:     735    12   41.06     12.71     0.0000    32.00     40.00     50.00      82.00  
 atrophy:     735     0   35.98     12.92     5.000     27.00     35.00     44.00      84.00  
   whgrd:     735     1   2.007     1.410     0.0000    1.000     2.000     3.000      9.000  
  numinf:     735     0   0.6109    0.9895    0.0000    0.0000    0.0000    1.000      5.000  
  volinf:     735     1   3.223     17.36     0.0000    0.0000    0.0000   0.09420     197.0  
 obstime:     735     0    1804     392.3     68.00      1837      1879      2044      2159   
   death:     735     0   0.1810    0.3852    0.0000    0.0000    0.0000    0.0000     1.000  
\end{Soutput}
\end{Schunk}

This call gives us a quick look at the distribution of each variable in the sample, and can be easily exported to a word processing software. This is important, because displaying raw R output in a publication is not usually ideal, and taking the time to format the output is a pain.

Notice that there are a lot of variables measured in these data, and that some interesting phenomena are measured by multiple variables. For instance, smoking is measured by \texttt{packyrs} and \texttt{yrsquit} - if someone has zero pack-years (that is, they have never smoked) then they will also have zero years quit. Similarly, a current smoker of any amount of packs per year will have zero years quit. We can also look at the variables measured through blood samples, like LDL cholesterol (\texttt{ldl}) and get an idea of the range in our sample population. Last, in the variables like \texttt{male} which consist of only two values (sex was measured as male or female in this dataset), the mean tells us the proportion of our sample who was male (or for other binary variables, it will tell us the proportion which is coded as 1). The \texttt{descrip} function works similarly to \texttt{summary} in base R, but gives more information and returns it in a format that, as we described above, is easier to export from R.

Another powerful feature of \texttt{descrip} is its ability to present stratified summaries, or summaries on a subset of the data. For instance, let's calculate descriptive statistics on the \texttt{age} variable within males and females:
\begin{Schunk}
\begin{Sinput}
> descrip(mri$age, strata = mri$male)
\end{Sinput}
\begin{Soutput}
                   N     Msng  Mean      Std Dev    Min       25%       Mdn       75%       Max     
mri$age:  All        735     0   74.57     5.451     65.00     71.00     74.00     78.00     99.00  
mri$age:    Str  0   369     0   74.41     5.258     65.00     71.00     73.00     78.00     91.00  
mri$age:    Str  1   366     0   74.73     5.642     66.00     71.00     74.00     78.00     99.00  
\end{Soutput}
\end{Schunk}

Here the row for \texttt{Str 0} corresponds to females (since they are coded as 0 for \texttt{male}), and males are \texttt{Str 1}. If we further wanted to restrict to only those people who were over 75 years old, we could use the \texttt{subset} argument:
\begin{Schunk}
\begin{Sinput}
> descrip(mri$age, strata = mri$male, subset = mri$age > 75)
\end{Sinput}
\begin{Soutput}
                   N     Msng  Mean      Std Dev    Min       25%       Mdn       75%       Max     
mri$age:  All        260     0   80.59     4.111     76.00     77.75     79.00     83.00     99.00  
mri$age:    Str  0   127     0   80.44     3.572     76.00     78.00     79.00     83.00     91.00  
mri$age:    Str  1   133     0   80.73     4.576     76.00     77.00     79.00     83.00     99.00  
\end{Soutput}
\end{Schunk}

However, the descrip function can only give us a fixed number of summaries (mean, count, etc). Oftentimes we need only a subset of these, or perhaps different summary measures. For this, we turn to more powerful functions.

\subsection{Flexibility: \texttt{tableStat()} and \texttt{tabulate()}}
The main draw of \texttt{tableStat()} and \texttt{tabulate()} is their ability to supply only a subset of the summary measures from \texttt{descrip()}. These functions focus on display and flexibility. The user supplies the format for the summary statistics to be displayed in, which makes exporting results from a call to \texttt{tablestat()} or \texttt{tabulate()} even easier than it was for \texttt{descrip()}. Of the two, \texttt{tableStat()} is the base, and \texttt{tabulate()} adds some additional formatting and options. For example, let's say that we want the same summary statistics as we would get from \texttt{descrip()}, but we want to control the printout. For this, we use the \texttt{stat} argument. The options are 
\begin{displaymath}
\begin{tabular}{cl|cl}
Name & Summary Measure & Name & Summary Measure\\
\hline
\texttt{"count"} & Number of observations on a variable & \texttt{"sd"} & Standard Deviation\\
\texttt{"missing"} & Number of missing observations & \texttt{"variance"} & Variance\\
\texttt{"mean"} & Arithmetic mean & \texttt{"min"} & Minimum value\\
\texttt{"geometric mean"} & Geometric mean & \texttt{"max"} & Maximum value\\
\texttt{"median"} & 50th percentile & \texttt{"quantiles"} & Display quantiles\\
\texttt{"probabilities"} & Display percentiles & \texttt{"mn(sd)"} & Display Mean (SD) format\\
\texttt{"range"} & Maximum value - minimum value & \texttt{"iqr"} & Interquartile range (75th - 25th percentiles)\\
\texttt{"all"} & Display all summary measures & \texttt{"row\%"} & Display row percentages\\
\texttt{"col\%"} & Display column percentages & \texttt{"tot\%"} & Display percentage of total\\
\end{tabular}
\label{stattable}
\end{displaymath}
The following gets us close to results we could display in a table for a puplication. We want to have 
\begin{displaymath}
N: \ n; \ Mean \ (SD): \ mn \ (sd); \ Range: \ max - min,
\end{displaymath}
which we get via:
\begin{Schunk}
\begin{Sinput}
> tableStat(mri$age, stat = "N: @count@; Mean (SD): @mean@ (@sd@); Range: @max@ - @min@")
\end{Sinput}
\begin{Soutput}
Tabled descriptive statistics by strata
Call:
      tableStat(variable = mri$age, stat = "N: @count@; Mean (SD): @mean@ (@sd@); Range: @max@ - @min@") 
            - NaN denotes strata with no observations
            - NA arises from missing or censored data

Format:  N: Cnt; Mean (SD): Mean (SD); Range: Max - Min 

                                                    .ALL 
N: 735.0; Mean (SD): 74.57 (5.451); Range: 99.00 - 65.00 
\end{Soutput}
\end{Schunk}

Note that all of the values enclosed in \texttt{@} symbols are from \ref{stattable} and are run by \texttt{tableStat()}, while the other values in the string are used for formatting. This function can also take stratification variables; if we want to see the above stratified by sex, we use
\begin{Schunk}
\begin{Sinput}
> tableStat(mri$age, strata = mri$male, stat = "N: @count@; Mean (SD): @mean@ (@sd@); Range: @min@ - @max@")
\end{Sinput}
\begin{Soutput}
Tabled descriptive statistics by strata
Call:
      tableStat(variable = mri$age, strata = mri$male, stat = "N: @count@; Mean (SD): @mean@ (@sd@); Range: @min@ - @max@") 
            - NaN denotes strata with no observations
            - NA arises from missing or censored data

Format:  N: Cnt; Mean (SD): Mean (SD); Range: Min - Max 

                                                strata.0                                                 strata.1                                               strata.ALL 
N: 369.0; Mean (SD): 74.41 (5.258); Range: 65.00 - 91.00 N: 366.0; Mean (SD): 74.73 (5.642); Range: 66.00 - 99.00 N: 735.0; Mean (SD): 74.57 (5.451); Range: 65.00 - 99.00 
\end{Soutput}
\end{Schunk}


\section{Analyses}
First, a disclaimer. All of the following analyses are for teaching. This is not the way that the authors recommend performing an analysis. We do emphasize heavily the need to prespecify all analyses in any setting, in order to have correct reproduceability and error rates. The two functions we will use in these analyses are \texttt{regress} and \texttt{lincom}. To learn more about either of these functions, type
\begin{Schunk}
\begin{Sinput}
> ?regress
> ?lincom
\end{Sinput}
\end{Schunk}

From these help files, we learn that the minimum we need to enter into \texttt{regress} is a functional, a formula, and a dataset. A functional takes an object and returns a value; for instance, the mean is a functional because it takes a distribution and returns the mean. The allowed functionals for \texttt{regress} are:
\begin{displaymath}
\begin{tabular}{c|l}
Functional & Type of Regression\\
\hline
\texttt{"mean"} & Linear Regression\\
\texttt{"geometric mean"} & Linear Regression on logarithmically transformed Y\\
\texttt{"odds"} & Logistic Regression\\
\texttt{"rate"} & Poisson Regression \\
\texttt{"hazard"} & Proportional Hazards Regression
\end{tabular}
\end{displaymath}
\subsection{Analysis 1}
A natural question is, ``Do males have lower cerebral atrophy score than females''? To answer this question, we run a linear regression of atrophy on the variable male:
\begin{Schunk}
\begin{Sinput}
> regress("mean", atrophy~age, data=mri)
\end{Sinput}
\begin{Soutput}
Call:
regress(fnctl = "mean", formula = atrophy ~ age, data = mri)

Residuals:
    Min      1Q  Median      3Q     Max 
-36.870  -8.589  -0.870   7.666  51.203 

Coefficients:
                 Estimate  Naive SE  Robust SE    95%L      95%H         F stat    df Pr(>F)   
[1] Intercept     -16.06     6.256     6.701       -29.22    -2.907           5.75 1    0.0168 
[2] age            0.6980   0.08368   0.09002       0.5213    0.8747         60.12 1  < 0.00005

Residual standard error: 12.36 on 733 degrees of freedom
Multiple R-squared:  0.08669,	Adjusted R-squared:  0.08545 
F-statistic: 60.12 on 1 and 733 DF,  p-value: 2.988e-14
\end{Soutput}
\end{Schunk}

\end{document}
